!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b,c,d){function k(a,b){var c=window.getComputedStyle(a)[b];return parseInt(c,10)}function l(){var a=C.scale(),b=[".nw",".ne",".se",".sw"],c=[".e",".w"],d=[".elapsedMS",".s"],e=_.union(b,c),f=_.union(b,d);_.map(e,function(b){d3.select(".resize"+b).select("rect").attr("width",6/a).attr("x",-3/a)}),_.map(f,function(b){d3.select(".resize"+b).select("rect").attr("height",6/a).attr("y",-3/a)})}function m(a,d,e,i){var k,l=Date.now(),o=b.getGEvNTMode();if(a>0){var p=Math.min((j-a)/j,1);k=n(d,e,p)}else k=e;var q=b.currentData(),r=q.active,u=q.inactive;console.log("Time after collecting data",Date.now()-l),l=Date.now(),"zoom"===i&&(F.clearRect(0,0,s+2*f,t+2*f),F.fillStyle=h,_.each(_.flatten([u,r]),function(a){var b=a[o],c=f+A(b.x_relative_offset),d=f+B(b.y_relative_offset);f>c||c>s+f||f>d||d>t+f||(F.beginPath(),F.arc(c,d,g,0,2*Math.PI),F.fill())})),console.log("Time to draw bg points:",Date.now()-l),l=Date.now(),E.clearRect(0,0,s+2*f,t+2*f),_.each(r,function(a){var b=a[o],d=f+A(b.x_relative_offset),e=f+B(b.y_relative_offset);f>d||d>s+f||f>e||e>t+f||(E.beginPath(),E.fillStyle=k(a[c]),E.arc(d,e,g,0,2*Math.PI),E.fill())}),E.fillStyle="white",E.fillRect(0,0,s+2*f,f),E.fillRect(0,0,f,t+2*f),E.fillRect(f+s,0,f,t+2*f),E.fillRect(0,t+f,s+2*f,f);var v=Date.now()-l;console.log("Start of call to end of draw call:",v),a>0&&setTimeout(m,0,a-v,d,e)}function n(a,b,c){var d=a.domain(),e=b.domain(),f=Math.min(d[0],e[0]),g=Math.max(d[1],e[1]),h=(g-f)/i,j=_.range(f,g+1,h),k=_.map(j,function(d){return d3.interpolateRgb(a(d),b(d))(c)});return d3.scale.linear().domain(j).range(k)}function o(a){m(0,ca,ca,a)}function p(b){"pan"===b?(d3.select(a).select("#brush-group").on("mousedown.brush",null),d3.select(a).select("#zoom-group").call(C),d3.select(a).select("#brush-group").style("pointer-events",null),d3.select(a).select("#zoom-group").style("pointer-events","all")):"brush"===b&&(d3.select(a).select("#brush-group").call(D),d3.select(a).select("#brush-group").style("pointer-events","all"),d3.select(a).select("#zoom-group").on("mousedown.zoom",null))}function q(a){m(j,ca,a),ca=a}function r(a){c=a,o()}var s,t,u=[0,_.max(b.getXLineOffsets())],v=[0,_.max(b.getYLineOffsets())],w=v[1]/u[1],x=k(d3.select(a).node(),"width")-2*f,y=k(d3.select(a).node(),"height")-2*f,z=y/x;z/w>1?(s=x,t=w*s):(t=y,s=1/w*t),d3.select(a).attr("width",s+2*f),d3.select(a).attr("height",t+2*f);var A=d3.scale.linear().domain(u).range([0,s]),B=d3.scale.linear().domain(v).range([t,0]),C=d3.behavior.zoom().x(A).y(B).scaleExtent([1,100]).on("zoom",function(){var a=d3.event.translate,b=d3.event.scale;a[0]=Math.min(0,Math.max(-s*b+s,a[0])),a[1]=Math.min(0,Math.max(-t*b+t,a[1])),C.translate(a),ba.attr("transform",e.translate(a[0],a[1])+"scale("+b+")");var c=_.filter(K,function(a){return 0<=A(a)&&A(a)<=s}),d=_.filter(M,function(a){return 0<=A(a)&&A(a)<=s}),f=_.filter(T,function(a){return 0<=B(a)&&B(a)<=t}),g=_.filter(V,function(a){return 0<=B(a)&&B(a)<=t});O.tickValues(c),P.tickValues(d),X.tickValues(f),Y.tickValues(g),R.call(P),$.call(Y),S.call(O),aa.call(X),o("zoom")}),D=d3.svg.brush().x(A.copy()).y(B.copy()).on("brush",function(){D.empty()||(b.addSpatialFilter(D.extent(),"spatial"),l())}).on("brushend",function(){D.empty()?b.removeSpatialFilter("spatial-stop"):b.addSpatialFilter(D.extent(),"spatial-stop")});d3.select(a+"-canvas").attr("width",s+2*f).attr("height",t+2*f);var E=document.getElementById(a.substring(1)+"-canvas").getContext("2d");d3.select(a+"-canvas-bak").attr("width",s+2*f).attr("height",t+2*f);var F=document.getElementById(a.substring(1)+"-canvas-bak").getContext("2d"),G=document.createElement("canvas");G.getContext("2d");G.setAttribute("width",s+2*f),G.setAttribute("height",t+2*f);var H=d3.select(a),I=35,J=25;H.append("text").attr("x",(s+2*f)/3).attr("width",(s+2*f)/3).attr("y",f+t+I).attr("height",J).classed("plot-title",!0).text(b.X_AXIS_ORGANISM_NAME),H.append("text").attr("transform","rotate(-90)").attr("x",-2*(t+2*f)/3).attr("width",(t+2*f)/3).attr("y",f-I).attr("height",J).classed("plot-title",!0).text(b.Y_AXIS_ORGANISM_NAME),H.append("defs").append("clipPath").attr("id","plot-clip-box").append("rect").attr("x",0).attr("width",s).attr("y",0).attr("height",t).attr("fill","black");var K=b.getXLineOffsets(),L=_.zip(_.initial(K),_.rest(K)),M=_.map(L,function(a){return(a[0]+a[1])/2}),N=_.object(M,b.getXLineNames()),O=d3.svg.axis().scale(A).tickValues(K).tickFormat(_.constant("")).orient("bottom").tickSize(-t),P=d3.svg.axis().scale(A).tickValues(M).tickFormat(function(a){return N[a]}).orient("bottom").tickSize(0),Q=H.append("g").attr("transform",e.translate(f,t+f)),R=Q.append("g").classed("xAxis",!0).call(P),S=Q.append("g").classed("xAxis",!0).call(O),T=b.getYLineOffsets(),U=_.zip(_.initial(T),_.rest(T)),V=_.map(U,function(a){return(a[0]+a[1])/2}),W=_.object(V,b.getYLineNames()),X=d3.svg.axis().scale(B).tickValues(T).tickFormat(_.constant("")).orient("left").tickSize(-s),Y=d3.svg.axis().scale(B).tickValues(V).tickFormat(function(a){return W[a]}).orient("left").tickSize(0),Z=H.append("g").attr("transform",e.translate(f,f)),$=Z.append("g").classed("yAxis",!0).call(Y),aa=Z.append("g").classed("yAxis",!0).call(X);H=H.append("g").attr("transform",e.translate(f,f)).append("g").attr("id","zoom-group").call(C).on("mousedown.zoom",null);var ba=H.append("g").attr("clip-path","url(#plot-clip-box)").append("g").attr("id","brush-group").call(D),ca=d;return b.addListener(o),o("zoom"),{setNavMode:p,setColorScale:q,setField:r}}var e=a("./utils.js"),f=50,g=2,h="#D0D0D0",i=100,j=500;c.synteny=d},{"./utils.js":7}],2:[function(a,b,c){"use strict";function d(a,b,c,d){function p(){I.empty()||b.addDataFilter(I.extent(),c)}function q(){I.empty()?b.removeDataFilter(c):b.addDataFilter(I.extent(),c,l?"data-stop":null)}function r(){var a=(_.chain(b.currentData().raw).pluck(c).sortBy().value(),h),d=x[0],e=x[1],f=e-d,g=f/a;return _.range(d,e,g)}function s(){return C}function t(a,b){function c(a,b){return Math.abs(a[b[0]].y-a[b[1]].y)}function d(a){var b=_.zip(_.range(0,a.length-1),_.range(1,a.length));return _.min(b,_.partial(c,a))}for(var e=m.removeNonExtrema(a);c(e,d(e))<b;){var f=d(e);if(0===f[0]){if(e.length<=3)break;e.splice(1,1)}else if(f[1]===e.length-1){if(e.length<=3)break;e.splice(e.length-2,1)}else{if(e.length<=4)break;e.splice(f[0],1)}e=m.removeNonExtrema(e)}e=_.partition(e,function(a,b,c){return 0===b||b===c.length-1||a.y>c[b-1].y||a.y>c[b+1].y});var g=e[0],h=e[1];if(g.length>3&&(g=_.chain(g).initial().rest().value()),_.each(g,function(a){_.defaults(a,{max:!0})}),_.each(h,function(a){_.defaults(a,{max:!1})}),j||k){var l=y.selectAll(".maxMark").data(g.concat(h));l.exit().remove(),l.enter().append("circle").classed("maxMark",1),l.attr("cx",function(a){return E(a.x+a.dx/2)}).attr("cy",function(a){return H(a.y)-5}).attr("r",3).attr("fill",function(a){return a.max?"red":"orange"}).attr("opacity",function(a){return a.max&&j||!a.max&&k?1:0})}_.each(g,function(a,b){a.colorIndex=b});var n=_.sortBy(h.concat(g),"x"),o=d3.scale.category10();C=d3.scale.linear().domain(_.map(n,function(a){return a.x+a.dx/2})).range(_.chain(n).map(function(a){return a.max?o(a.colorIndex):i}).value())}function u(a){var b=I.empty()?_.constant(!0):function(a){return a.x+a.dx>I.extent()[0]&&a.x<I.extent()[1]};a.attr("x",function(a){return E(a.x)}).attr("width",function(a){return E(a.x+a.dx)-E(a.x)}).attr("y",function(a){return H(a.y)}).attr("height",function(a){return A-e-H(a.y)}).attr("fill",function(a){return b(a)?D(a.x+a.dx/2):"grey"})}function v(a){a=a||"";var d=b.currentDataSummary(F,c);t(d,o.getPersistence()),y.selectAll(".dataBars").data(d).call(u),(a.indexOf("spatial-stop")>=0||"data-stop"===a)&&(G=[0,1.5*d3.max(_.pluck(d,"y"))],H.domain(G),L.transition().duration(f).call(K),y.selectAll(".dataBars").data(d).transition().duration(f).call(u),y.selectAll(".maxMark").transition().duration(f).attr("cy",function(a){return H(a.y)-5}))}function w(a){D=a,y.selectAll(".dataBars").transition().duration(g).call(u)}var x=d3.extent(_.pluck(b.currentData().raw,c)),y=d3.select(a),z=n.getComputedAttr(y.node(),"width"),A=n.getComputedAttr(y.node(),"height"),B={logks:"log(ks)",logkn:"log(kn)",logkskn:"log(ks/kn)"};y.append("text").attr("x",2*A/3).attr("width",A/3).attr("y",50).attr("height",50).classed("histogram-title",!0).text(B[c]);var C,D=d,E=d3.scale.linear().domain(x).range([e,z-e]),F=r(),G=[0,1.5*d3.max(_.pluck(b.currentDataSummary(F,c),"y"))],H=d3.scale.linear().domain(G).range([A-e,e]),I=d3.svg.brush().x(E).on("brush",p).on("brushend",q);y.selectAll(".dataBars").data(F).enter().append("rect").classed("dataBars",!0),y.append("g").attr("id","plotbrush-group").attr("transform",n.translate(0,e)).call(I).selectAll("rect").attr("height",A-2*e);var J=d3.svg.axis().scale(E).orient("bottom").tickSize(10),K=d3.svg.axis().scale(H).orient("left").ticks(5);y.append("g").attr("transform",n.translate(0,A-e)).classed("xAxis",!0).call(J);var L=y.append("g").attr("transform",n.translate(e,0)).classed("yAxis",!0).call(K);return v("initial"),b.addListener(v),{setColorScale:w,getAutoScale:s,refreshAutoScale:v}}var e=50,f=750,g=500,h=100,i="#D0D0D0",j=!0,k=!0,l=!1,m=a("./persistence"),n=a("./utils"),o=a("./window");c.histogram=d},{"./persistence":4,"./utils":7,"./window":8}],3:[function(a,b,c){"use strict";function d(a){var b=a.replace(/\|\|/g,",").replace(/\t/g,",").replace(" ",""),c=_.compact(b.split("\n"));return _.chain(c).reject(function(a){return"#"===a[0]}).map(e).filter(function(a){return isFinite(a.logks)&&isFinite(a.logkn)}).value()}function e(a){var b=a.split(",");return{ks:Number(b[0]),logks:Math.log(Number(b[0]))/Math.log(10),kn:Number(b[1]),logkn:Math.log(Number(b[1]))/Math.log(10),logkskn:(Math.log(Number(b[0]))-Math.log(Number(b[1])))/Math.log(10),x_chromosome_id:b[3],y_chromosome_id:b[15],ge:{x_relative_offset:Number(b[10]),y_relative_offset:Number(b[22])},nt:{x_relative_offset:Math.round((Number(b[4])+Number(b[5]))/2),y_relative_offset:Math.round((Number(b[16])+Number(b[17]))/2)}}}function f(a){var b=_.chain(a).sortBy("length").reverse().reduce(function(a,b){return a[b.name]=a.total,a.total+=b.length,a},{total:0}).value(),c=_.chain(a).sortBy("length").reverse().reduce(function(a,b){return a[b.name]=a.total,a.total+=b.gene_count,a},{total:0}).value(),d=_.chain(a).sortBy("name").reduce(function(a,b){return a[b.name]=a.total,a.total+=b.gene_count,a},{total:0}).value(),e=_.reduce(a,function(a,b){return a[b.name]=b.gene_count,a},{});return{nt:b,ge:c,name:d,gene_counts:e}}function g(a,b,c){return _.each(a,function(a){var d=b.nt[a.x_chromosome_id],e=c.nt[a.y_chromosome_id];a.nt.x_relative_offset+=d,a.nt.y_relative_offset+=e;var f=b.name[a.x_chromosome_id],g=c.name[a.y_chromosome_id];d=b.ge[a.x_chromosome_id],e=c.ge[a.y_chromosome_id],a.ge.x_relative_offset-=f,a.ge.y_relative_offset-=g,a.ge.x_relative_offset+=d,a.ge.y_relative_offset+=e}),a}function h(a,b,c){return c?function(d){return a<=d[c]&&d[c]<b}:function(c){return c>=a&&b>c}}function i(a,b,c){function d(a){return _.chain(a).pairs().sortBy("1").pluck("0").reject(function(a){return"total"===a}).value()}var e=b.ge,f=c.ge,g={};console.log(e);var i={},m={};g.X_AXIS_ORGANISM_NAME=j,g.Y_AXIS_ORGANISM_NAME=k,g.getXLineOffsets=function(){return _.chain(e).values().sortBy().value()},g.getYLineOffsets=function(){return _.chain(f).values().sortBy().value()};var n="nt";g.setGEvNTMode=function(a){n=a,e=b[a],f=c[a],g.notifyListeners("ge-v-nt-change")},g.getGEvNTMode=function(){return n},g.setOrder=function(b,c){a=_.sortBy(a,b),c&&a.reverse(),g.notifyListeners("order-change")},g.getXLineNames=function(){return d(e)},g.getYLineNames=function(){return d(f)},g.currentData=function(){return _.reduce(m,function(a,b){var c=_.partition(a.active,b);return a.active=c[0],a.inactive=a.inactive.concat(c[1]),a},{raw:a,active:a,inactive:[]})},g.currentDataSummary=function(b,c){var d=_.omit(m,c);i[c]||(i[c]=_.sortBy(a,c));var e=_.reduce(d,function(a,b){return _.filter(a,b)},i[c]),f=b[1]-b[0];return _.chain(b).map(function(a){var b={},d={};b[c]=a,d[c]=a+f;var g=_.sortedIndex(e,b,c),h=_.sortedIndex(e,d,c);return{x:a,dx:f,y:h-g}}).value()},g.addSpatialFilter=function(a,b){m.spatial=function(b){return b[n].x_relative_offset>=a[0][0]&&b[n].x_relative_offset<=a[1][0]&&b[n].y_relative_offset>=a[0][1]&&b[n].y_relative_offset<=a[1][1]},g.notifyListeners(b)},g.removeSpatialFilter=function(a){delete m.spatial,g.notifyListeners(a)},g.addDataFilter=function(a,b,c){m[b]=h(a[0],a[1],b),g.notifyListeners(c||"data")},g.removeDataFilter=function(a,b){delete m[a],g.notifyListeners("data-stop")};var o=[];if(g.addListener=function(a){o.push(a)},g.notifyListeners=function(a){_.each(o,function(b){b(a)})},l){var p=g.currentData;g.currentData=function(){var a=Date.now(),b=p();return console.log("currentData",Date.now()-a),b};var q=g.currentDataSummary;g.currentDataSummary=function(a,b){var c=Date.now(),d=q(a,b);return console.log("currentDataSummary",Date.now()-c),d};var r=g.notifyListeners;g.notifyListeners=function(a){console.log("notifyListeners"),r(a)}}return g.setOrder("logks",!0),g.setGEvNTMode(n),g}var j,k,l=!1,m=function(a,b,c,e){queue().defer(d3.text,a).defer(d3.json,"lengths/"+b+".json").defer(d3.json,"lengths/"+c+".json").await(function(a,b,c,h){if(a)return void console.log(a);j=c.organism.name,k=h.organism.name;var l=d(b),m=f(c.chromosomes),n=f(h.chromosomes),o=g(l,m,n),p=i(o,m,n);console.log("Total synteny dots:",p.currentData().raw.length),e(p)})};c.loadksData=m},{}],4:[function(a,b,c){(function(a){"use strict";function b(a){return d.filter(a,function(b,c){if(0===c||c===a.length-1)return!0;var d=a[c-1].y,e=b.y,f=a[c+1].y;return e>Math.max(d,f)||e<Math.min(d,f)})}var d="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null;c.removeNonExtrema=b}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(a,b,c){(function(b){"use strict";function d(a){e=function(){h.each(o,function(a){a.refreshAutoScale()})};var b;i.selectAll("#mouse-options input[name=mouse-options]").on("change",function(){b.setNavMode(this.value)}),i.selectAll("#summary-options input[name=summary-options]").on("change",function(){a.setOrder("logks","minimum"===this.value)}),i.selectAll("#plot-var-options input[name=plot-var-options]").on("change",function(){o[c].setColorScale(m),c=this.value,b.setField(c);var a;a="auto"===d?o[c].getAutoScale():l[c][d],b.setColorScale(a),o[c].setColorScale(a)});var c="logks",d="rg";i.selectAll("#color-options input[name=color-options]").on("change",function(){var a;a="auto"===this.value?o[c].getAutoScale():l[c][this.value],console.log(a),o[c].setColorScale(a),b.setColorScale(a),d=this.value});var k=["logks","logkn","logkskn"],l=h.chain(k).map(function(b){return[b,i.extent(h.pluck(a.currentData().raw,b))]}).object().mapValues(function(a){var b=a[1],c=a[0],d=b-c;return h.mapValues(j,function(a,e){var f=d/(a.length-1),g=h.range(c,b+.5*f,f),j=e.indexOf("quantized")>-1?i.scale.quantize():i.scale.linear();return j.domain(g).range(a)})}).value(),m=h.constant("steelblue"),n=l[c].rg;b=g.synteny("#dotplot",a,"logks",n);var o={logks:f.histogram("#plot",a,"logks",n),logkn:f.histogram("#plot2",a,"logkn",m),logkskn:f.histogram("#plot3",a,"logkskn",m)};a.notifyListeners("initial")}var e,f=a("./histogram"),g=a("./dotplot"),h="undefined"!=typeof window?window._:"undefined"!=typeof b?b._:null,i="undefined"!=typeof window?window.d3:"undefined"!=typeof b?b.d3:null,j={rg:["red","green"],rg_quantized:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],rainbow:["blue","magenta","aqua","lime","red","orange"],rainbow_quantized:["blue","magenta","aqua","lime","red","orange"]};c.controller=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./dotplot":1,"./histogram":2}],6:[function(a,b,c){var d=a("./synteny-vis"),e=a("./main");switch(window.location.hash){case"#m":case"#maize":e.loadksData("./data/6807_8082.CDS-CDS.dcmegablast.tdd10.cs0.filtered.dag.all.go_D40_g20_A10.aligncoords.gcoords.ks","6807","8082",d.controller);break;case"#e":case"#ecoli":e.loadksData("./data/4241_4242.CDS-CDS.last.tdd10.cs0.filtered.dag.all.go_D20_g10_A5.aligncoords.gcoords.ks","4241","4242",d.controller);break;case"#a":case"#arabidopsis":e.loadksData("./data/16911_3068.CDS-CDS.last.tdd10.cs0.filtered.dag.all.go_D20_g10_A5.aligncoords.gcoords.ks","16911","3068",d.controller);break;default:case"#h":case"#homo":window.location.hash="#homo",e.loadksData("./data/11691_25577.CDS-CDS.last.tdd10.cs0.filtered.dag.all.go_D20_g10_A5.aligncoords.gcoords.ks","11691","25577",d.controller)}},{"./main":3,"./synteny-vis":5}],7:[function(a,b,c){c.getComputedAttr=function(a,b){var c=window.getComputedStyle(a)[b];return parseInt(c,10)},c.translate=function(a,b){return"translate("+a+","+b+")"}},{}],8:[function(a,b,c){"use strict";c.getPersistence=function(){return Number(document.getElementById("persistence").value)}},{}]},{},[1,2,3,4,5,6,7,8]);